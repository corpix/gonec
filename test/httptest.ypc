дтнач = ТекущаяДата()

йопта ОбработатьСерв(вых,вх)
    малява("Сервер получил запрос:\n",вх.Сообщение())
    вых.Отправить({"Статус":200, "Тело":"Запрос обработан успешно"})
стопэйопта

серв = захуярить Сервер
хапнуть
    серв.Открыть("http", "127.0.0.1:9990", 1000, {"/test":ОбработатьСерв}, 0)
гоп
    малява(ОписаниеОшибки())
    малява("Кажется сервер уже запущен, иличо тут какая-то другая ошибка, но мы все равно попробуем отправить запрос :)")
стопэхапать

гр = захуярить ГруппаОжидания

фобр = йопта (соед)
	д = соед.Данные()
	малява("Устанавливаем соединение:",соед)
	запр={
        "Метод": "GET",
        "Путь": "http://127.0.0.1:9990/test",
        "Заголовки": {
            "ReqId":соед.Идентификатор(),
            },
        "Параметры": {
                "id":соед.Идентификатор(),
                "query":"Запрос по http протоколу",
                "num": д[1],
           },
		}
	малява("Отправляем:", запр)
	хапнуть
	    малява("Ответ",д[1],":",соед.Запрос(запр))
	гоп
	    малява(ОписаниеОшибки())
	стопэхапать
	соед.Закрыть()
    д[0].Завершить() // группа ожидания
стопэйопта

го н=1 по 1000 жы
    кли = захуярить Клиент
	гр.Добавить(1)
	кли.Открыть("http", "127.0.0.1:9990", фобр, [гр, н])
стопэжы

гр.Ожидать()

серв.Закрыть()

малява("Все завершилось просто идеально за", ПрошлоВремениС(дтнач), "!")

//асинхронно
гр = захуярить ГруппаОжидания
фобр = йопта (соед)
    малява("Устанавливаем соединение:",соед)
    запр={
                "Метод": "GET",
            "Путь": "http://ya.ru",
        }
    малява("Отправляем:", запр)
    малява("Ответ:",соед.Запрос(запр))
    соед.Данные()[0].Завершить()
стопэйопта

кли = захуярить Клиент
гр.Добавить(1)
кли.Открыть("http", "", фобр, [гр])
гр.Ожидать()

//синхронно
кли = захуярить Клиент
соед = кли.Соединить("http","")
малява("Устанавливаем соединение:",соед)
запр={
    "Метод": "GET",
    "Путь": "http://ya.ru",
}
малява("Отправляем:", запр)
малява("Ответ:",соед.Запрос(запр))
соед.Закрыть()	