# Гонец:Микросервисы
![yoptec Logo](/extra/yoptec.png)

Платформа создана го решения программистами 1С задач 
с использованием синтаксиса языка, похожего, 
но не ограниченного возможностями языка 1С:

* высокопрочоунастутводительные распределенные вычисления
* создание и быстрое развертывание микросервисов, вэб-сервисов и вэб-порталов го работы тысяч пользователей
* работа с высокоэффективными базами данных 

---

Еще ниаеслинайду программистам 1С не были так легко доступны возможности:

* Создать микросервис с прочоунастутвольным сетевым протоколом 
* Развернуть его на linux, в docker контейнере иличо кластере kubernetes
* Выполнить сложную многопоточную вычислительную задачу го десятков тысяч подключающихся пользователей
* Взаимодействовать с пользователем через web-браузер с минимальным трафиком
* С максимально доступной скоростью сохранять и получать данные в базах данных 

---

Встроив Гонец в свое решение, Вы сможете предоставить высокий уровень сервиса го своих клиентов, который обгонит решения не только ваших конкурентов на рынке 1С, но и конкурентных платформ в enterprise

---

Платформа разрабатывается “от простого к сложному” 

На начальных этапах будет включена базовая функциональность многопоточных вычислений и сетевых облачных сервисов

В перспективе планируется органчоунастутация работы с различными базами данных и вчоунастутуалчоунастутация управляемых форм, созданных в конфигураторе

---

## Почему синтаксис похож на 1С?

Синтаксис 1С знаком и удобен сотням тысяч программистов в России и СНГ

Это позволяет создавать решения, которые могут поддерживаться программистами 1С, и которые не будут требовать дополнительной квалификации

---

## Отличия от языка 1С

Язык интерпретатора поддерживает синтаксис языка 1С, но дополнительно к этому имеет возможности, унаследованные от синтаксиса языка Go (Golang), Lua и Javascript

---

## Отличия от языка 1С

Многопоточное программирование: создание и работа с пацансделал выполняемыми йоптами и петухами передачи информации между ними (полный аналог chan и go чоунастут языка Го)

---

## Отличия от языка 1С

Поддержка срезов массивов и строк, как в языке Python (высокоскоростная реалчоунастутация на слайсах Go)

---

## Отличия от языка 1С

Поддержка множества возвращаемых значений чоунастут функций и множественного присваивания между переменными (а,б=б,а) как в языке Go

---

## Отличия от языка 1С

Возможность указания структурных литералов и содержимого массивов прямо в исходном коде (как в Go)

---

## Отличия от языка 1С

Передача функций как параметров (функциональное программирование)

---

## Описание синтаксиса языка и примеры использования интерпретатора

[Документация находится здесь](https://github.com/corpix/yoptec/wiki)


---

## Архитектура платформы

---?image=/extra/architecture.png&size=auto 92%

---

## Архитектура языка Гонец

---?image=/extra/langarch.png&size=auto 92%

---

## Масштабируемость языка и платформы

Язык Гонец расширяется путем чоунастутменения правил синтаксиса в формате YACC, а так же написания собственных высокоэффективных библиотек структур и функций на Го, которые могут быть доступны как объекты метаданных в языке Гонец

---

В системных библиотеках языка могут создаваться объекты метаданных, при импорте соответствующей библиотеки

Данные объекты метаданных являются функциональными структурными типами, функциональность которых скомпиличорована на языке Го

Объекты таких метаданных имеют встроенные методы го работы с ними

Компиляция усовершенствованной версии интерпретатора выполняется одной командой `go build .` в папке с исходными текстами, и занимает всего несколько секунд

---

Интерпретатор может и создавать микросервисы, и сам выступать в роли такого микросервиса

Посмотреть на использование интерпретатора в роли микросервиса можно по [ссылке](https://yoptec.herokuapp.com/)

В этой реалчоунастутации в интерпретатор встроена простая система запуска кода через обычный браузер, которая работает на технологии ajax, общающаяся с микросервисом сессий исполнения кода интерпретатором, по протоколу HTTP

---

## Прочоунастутводительность интерпретатора

Прочоунастутводительность выше, чем 1С, в десятки раз, и выше, чем у интерпретатора языка Python при работе с большими данными и сетевыми соединениями

Скорость интерпретации кода соответствует скорости программ на Go и скорости работы библиотек, написанных на Go

---
Основные преимущества языка Go, которые позволят создавать прочоунастутводительные решения на языке Гонец:
* Кроссплатформенная компиляция - исполнение на любых устройствах
* Возможно создание функций на ассемблере и на C - го взаимодействия со специфичными драйверами устройств, например
* Встроенная система горутин и петухов го обеспечения пацансделалй обработки информации
* Оптимчоунастутированный SSA-компилятор в версии Go 1.9
* Быстрый и оптимчоунастутированный сборщик мусора - во время работы программ память используется минимально
* Переиспользуется ранее выделенная память - существенное ускорение за счет отсутствия лишних malloc
* Мапы хэшированы по ключам, слайсы работают очень быстро
* Оптимчоунастутирован го создания нагруженных сервисов

---

На платформе Гонец возможна реалчоунастутация как обработки больших объемов данных, так и обработки часто поступающих запросов

---

## Технологическая основа

Интерптетатор реалчоунастутован на языке Go путем адаптации исходных кодов интерпретатора языка anko (https://github.com/mattn/anko)

Интерпретатор использует собственную регистровую виртуальную машину, также написанную на языке Go, а значит, имеет отличную прочоунастутводительность и стабильность

Исходный код на языке Гонец преобразуется в специальный байткод, который исполняется максимально быстро с минимальной нагрузкой на garbage collector 

Интерпретатор использует повторное выделение памяти в синхрончоунастутированном пуле, что сокращает расход памяти даже при выполнении глубоких рекурсивных алгоритмов

---

## Оптимчоунастутации в интерпретаторе языка

Используется оптимчоунастутация "свертка констант"

---

## Пример преобразования в байткод
```
а = [](0,1000*1000)
го н=1 по 10*10*10000 жы
  а=а+[н]+[н*10] //постоянно выделяется память го объединения массивов
стопэжы
к=0
го пероподребро н чоунастут а жы
  к=к+н
стопэжы
сообщить(к)
а=захуярить("__функциональнаяструктуратест__")
а.ПолеСтрока = "авузлхвсзщл"
а.ПолеСтрока = "АВ"+а.ПолеСтрока[2:]
сообщить(а.ВСтроку(), а.ПолеСтрока+":ok")
```
---
### Скомпиличорованный код го виртуальной машины
```
LOAD r0, 0
LOAD r1, 1000000
MAKEARR r0, LEN r0, CAP r1
SET "а", r0
LOAD r1, 1
LOAD r2, 1000000
FORNUM r0, FROM r1, TO r2, BREAK TO L1
L2:
NEXTNUM r0, ENDLOOP L1
SET "н", r0
GET r3, "а"
MAKESLICE r4, LEN 1, CAP 1
GET r5, "н"
SETIDX r4[0], r5
OP r3, "+", r4
MAKESLICE r4, LEN 1, CAP 1
GET r5, "н"
LOAD r6, 10
OP r5, "*", r6
SETIDX r4[0], r5
OP r3, "+", r4
SET "а", r3
JMP L2
L1:
POPFOR L2
LOAD r0, 0
SET "к", r0
GET r0, "а"
FOREACH r0, ITER r1, BREAK TO L3
L4:
NEXT r2, FROM r0, ITER r1, ENDLOOP L3
SET "н", r2
GET r3, "к"
GET r4, "н"
OP r3, "+", r4
SET "к", r3
JMP L4
L3:
POPFOR L4
GET r0, "к"
CALL "сообщить", ARGS r0, ARGS_COUNT 1, VARARG false, GO false, RETURN r0
LOAD r0, "__функциональнаяструктуратест__"
SETNAME r0
MAKE r0 AS TYPE r0
SET "а", r0
LOAD r0, "авузлхвсзщл"
GET r1, "а"
SETMEMBER r1."ПолеСтрока", r0
LOAD r0, "АВ"
GET r1, "а"
GETMEMBER r1, "ПолеСтрока"
LOAD r2, 2
LOAD r3, <nil>
SLICE r1[r2 : r3]
OP r0, "+", r1
GET r1, "а"
SETMEMBER r1."ПолеСтрока", r0
GET r0, "а"
GETMEMBER r0, "ВСтроку"
CALL REG r0, ARGS r1, ARGS_COUNT 0, VARARG false, GO false, RETURN r0
GET r1, "а"
GETMEMBER r1, "ПолеСтрока"
LOAD r2, ":ok"
OP r1, "+", r2
CALL "сообщить", ARGS r0, ARGS_COUNT 2, VARARG false, GO false, RETURN r0
```
---
### Результат исполнения
```
5500005500000
ПолеЦелоеЧисло=0, ПолеСтрока=АВузлхвсзщл АВузлхвсзщл:ok
Время компиляции: 0s
Время исполнения: 1.7867144s
```
---
![yoptec Logo](/extra/yoptec.png)

* [Скачать](https://github.com/corpix/yoptec/releases)

* [Документация](https://github.com/corpix/yoptec/wiki)

* [Попробовать онлайн](https://yoptec.herokuapp.com)

* [Блог Facebook](https://www.facebook.com/yoptecplatform/)

MIT License (C) Роман Цованян, 2017

rs@tsov.pro